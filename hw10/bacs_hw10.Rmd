---
title: "bacs_hw10"
author: '110071010'
date: "2024-04-27"
output: word_document
---

# Pre-setting

Create a data.frame called cars_log with log-transformed columns for mpg, weight, and acceleration (model_year and origin don’t have to be transformed)

```{r, results="hold"}
cars <- read.table("auto-data.txt", header=FALSE, na.strings = "?")
names(cars) <- c("mpg", "cylinders", "displacement", "horsepower", "weight","acceleration", "model_year", "origin", "car_name")
cars_log <- with(cars, data.frame(log(mpg), log(weight), log(acceleration), model_year, origin))
```

# Question 1

Let’s visualize how weight and acceleration are related to mpg.

## 1a

Let’s visualize how weight might moderate the relationship between acceleration and mpg

### i

Create two subsets of your data, one for light-weight cars (less than mean weight) and one for heavy cars (higher than the mean weight)

```{r, results="hold"}
mm <- mean(cars_log$log.weight.)
cars_light <- subset(cars_log, log.weight. < mm)
cars_heavy <- subset(cars_log, log.weight. > mm)
```

### ii

Create a single scatterplot of acceleration vs. mpg, with different colors and/or shapes for light versus heavy cars

```{r, results="hold"}
weight_colors = c("cornflowerblue", "coral3")
with(cars_light, plot(scale(log.acceleration.), pch = 18, scale(log.mpg.), col=weight_colors[1]))
with(cars_heavy, points(scale(log.acceleration.), pch = 18, scale(log.mpg.), col=weight_colors[2]))
```

### iii

Draw two slopes of acceleration-vs-mpg over the scatter plot: one slope for light cars and one slope for heavy cars (distinguish them by appearance)

```{r, results="hold"}
weight_colors = c("cornflowerblue", "coral3")
with(cars_light, plot(scale(log.acceleration.), pch = 18, scale(log.mpg.), col=weight_colors[1]))
with(cars_heavy, points(scale(log.acceleration.), pch = 18, scale(log.mpg.), col=weight_colors[2]))

with(cars_light, abline(lm(scale(log.acceleration.)~scale(log.mpg.)), col=weight_colors[1], lwd=2))
with(cars_heavy, abline(lm(scale(log.acceleration.)~scale(log.mpg.)), col=weight_colors[2], lwd=2))
```

## 1b

Report the full summaries of two separate regressions for light and heavy cars where log.mpg. is dependent on log.weight., log.acceleration., model_year and origin

```{r, results="hold"}
# Light cars
summary(lm(log.mpg. ~ log.weight.+log.acceleration.+model_year+factor(origin),data=cars_light))
```

```{r, results="hold"}
# Heavy cars
summary(lm(log.mpg. ~ log.weight.+log.acceleration.+model_year+factor(origin),data=cars_heavy))
```

## 1c

[**Question**]{.underline}

Using your intuition only: What do you observe about light versus heavy cars so far?

[**Answer**]{.underline}

Heavy cars display stronger acceleration-mpg relationship.

# Question 2

Use the transformed dataset from above (cars_log), to test whether we have moderation.

## 2a

[**Instruction**]{.underline}

Considering weight and acceleration, use your intuition and experience to state which of the two variables might be a moderating versus independent variable, in affecting mileage.

[**Answer**]{.underline}

Weight is the moderator,and acceleration is the independent variable.

## 2b

Use various regression models to model the possible moderation on log.mpg.:\
(use log.weight., log.acceleration., model_year and origin as independent variables)

### i

Report a regression without any interaction terms

```{r, results="hold"}
lm(log.mpg. ~ log.weight.+log.acceleration.+model_year+factor(origin), data=cars_log)
```

### ii

Report a regression with an interaction between weight and acceleration

```{r, results="hold"}
lm(log.mpg. ~ log.weight.+log.acceleration.+model_year+factor(origin)+log.weight.* log.acceleration., data=cars_log)
```

### iii

Report a regression with a mean-centered interaction term

```{r, results="hold"}
log.weight._mean_centered <- scale(cars_log$log.weight., center=TRUE, scale=FALSE)
log.acceleration._mean_centered <- scale(cars_log$log.acceleration., center=TRUE, scale=FALSE)
```

```{r, results="hold"}
lm(log.mpg. ~ log.weight._mean_centered +log.acceleration._mean_centered +model_year+factor(origin)+log.weight._mean_centered *log.acceleration._mean_centered , data=cars_log)
```

### iv

Report a regression with an orthogonalized interaction term

```{r, results="hold"}
interaction_regr <- lm(cars_log$log.weight. * cars_log$log.acceleration. ~ cars_log$log.weight.+cars_log$log.acceleration.)
interaction_ortho <- interaction_regr$residuals
lm(log.mpg. ~ log.weight.+log.acceleration.+model_year+factor(origin)+ interaction_ortho, data=cars_log)
```

## 2c

[**Question**]{.underline}

For each of the interaction term strategies above (raw, mean-centered, orthogonalized) what is the correlation between that interaction term and the two variables that you multiplied together?

[**Answer**]{.underline}

interaction_term – log.weight. : 0.108305532

interaction_term – log.acceleration. : 0.852881042

```{r, results="hold"}
cor(cbind(interaction_term = cars_log$log.weight * cars_log$log.acceleration.,cars_log))
```

# Question 3

Let’s check whether weight mediates the relationship between cylinders and mpg, even when other factors are controlled for.  Use log.mpg., log.weight., and log.cylinders as your main variables, and keep log.acceleration., model_year, and origin as control variables.

## 3a

Let’s try computing the direct effects first:

### i

[**Instruction**]{.underline}

Model 1: Regress log.weight. over log.cylinders. only

Check whether number of cylinders has a significant direct effect on weight

[**Observation**]{.underline}

Yes. The coefficient of 0.8201 reflects a strong positive relationship.

```{r, results="hold"}
cars_log1 <- with(cars, data.frame(log(mpg), log(weight), log(acceleration),log(cylinders), model_year, origin))
A <- lm(log.weight. ~ log.cylinders., data=cars_log1)
A
```

### ii

[**Instruction**]{.underline}

Model 2: Regress log.mpg. over log.weight. and all control variables

Check whether weight has a significant direct effect on mpg with other variables statistically controlled

[**Observation**]{.underline}

Yes. The coefficient of -0.87661 reflects a strong negative relationship.

```{r, results="hold"}
B <- lm(log.mpg. ~ log.weight.+log.acceleration.+model_year+factor(origin), data=cars_log1)
B
```

## 3b

What is the indirect effect of cylinders on mpg? (use the product of slopes between Models 1 & 2)

```{r, results="hold"}
(A$coefficients[2]) * (B$coefficients[2])
```

## 3c

Let’s bootstrap for the confidence interval of the indirect effect of cylinders on mpg

### i

Bootstrap regression models 1 & 2, and compute the indirect effect each time:\
What is its 95% CI of the indirect effect of log.cylinders. on log.mpg.?

```{r, results="hold"}
boot_mediation <- function(model_a, model_b, dataset) {
  boot_index <- sample(1:nrow(dataset), replace=TRUE)
  data_boot <- dataset[boot_index, ]
  regr1 <- lm(model_a, data_boot)
  regr2 <- lm(model_b, data_boot)
  return(regr1$coefficients[2] * regr2$coefficients[2])
}

set.seed(12341234)
indirect <- replicate(2000, boot_mediation(A, B, cars_log1))
quantile(indirect, probs=c(0.025, 0.975))
```

### ii

Show a density plot of the distribution of the indirect effect, and mark its 95% CI

```{r, results="hold"}
plot(density(indirect),main = "Indirect Effect Distribution", col = "cornflowerblue", lwd = 2)
abline(v = quantile(indirect, probs=c(0.025, 0.975)), col = "gray", lwd = 2)
```
